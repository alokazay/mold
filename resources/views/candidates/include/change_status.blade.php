<div class="modal fade" tabindex="-1" id="modal_candidate_status_13">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Архив отказ</h3>
                <input type="hidden" id="modal_candidate_status_13_id">

                <!--begin::Close-->
                <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal"
                     aria-label="Close">
                    <span class="svg-icon svg-icon-2x"></span>
                </div>
                <!--end::Close-->
            </div>
            <!--begin::Modal body-->
            <div class="modal-body">
                <div class="row mb-5">
                    <div class="col">
                        <label for="modal_candidate_status_13__comment"
                               class="required fs-5 fw-bold mb-2">Комментарий</label>
                        <textarea class="form-control form-control-sm form-control-solid"
                                  cols="30" id="modal_candidate_status_13__comment"></textarea>
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light btn-sm" data-bs-dismiss="modal">Отмена</button>
                <button id="modal_candidate_status_13__save" type="button" class="btn btn-primary btn-sm">Сохранить
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" tabindex="-1" id="modal_candidate_status_14">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Перезвонить</h3>
                <input type="hidden" id="modal_candidate_status_14_id">
                <!--begin::Close-->
                <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal"
                     aria-label="Close">
                    <span class="svg-icon svg-icon-2x"></span>
                </div>
                <!--end::Close-->
            </div>
            <!--begin::Modal body-->
            <div class="modal-body">
                <div class="row mb-5">
                    <div class="col">

                        <div class="d-flex flex-column mb-0 fv-row">
                            <label for="modal_candidate_status_14__date" class="fs-5 fw-bold mb-2">Дата
                                перезвона</label>
                            <input
                                id="modal_candidate_status_14__date"
                                class="form-control form-control-sm form-control-solid"
                                type="text"/>
                        </div>
                    </div>
                </div>
                <div class="row mb-5">
                    <div class="col">
                        <label for="modal_candidate_status_14__comment"
                               class="required fs-5 fw-bold mb-2">Комментарий</label>
                        <textarea class="form-control form-control-sm form-control-solid"
                                  cols="30" id="modal_candidate_status_14__comment"></textarea>
                    </div>
                </div>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-light btn-sm" data-bs-dismiss="modal">Отмена</button>
                <button id="modal_candidate_status_14__save" type="button" class="btn btn-primary btn-sm">Сохранить
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" tabindex="-1" id="modal_candidate_status_15">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Недозвон</h3>
                <input type="hidden" id="modal_candidate_status_15_id">
                <input type="hidden" id="modal_candidate_status_15_callFailed">

                <!--begin::Close-->
                <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal"
                     aria-label="Close">
                    <span class="svg-icon svg-icon-2x"></span>
                </div>
                <!--end::Close-->
            </div>
            <!--begin::Modal body-->
            <div class="modal-body callFailed">
                <div class="row mb-5">
                    <div class="col">

                        <div class="d-flex flex-column mb-0 fv-row">
                            <label for="modal_candidate_status_15__date" class="fs-5 fw-bold mb-2">Дата
                                перезвона</label>
                            <input
                                id="modal_candidate_status_15__date"
                                class="form-control form-control-sm form-control-solid"
                                type="text"/>
                        </div>
                    </div>
                </div>
                <div class="row mb-5">
                    <div class="col">
                        <label for="modal_candidate_status_15__comment"
                               class="required fs-5 fw-bold mb-2">Комментарий</label>
                        <textarea class="form-control form-control-sm form-control-solid"
                                  cols="30" id="modal_candidate_status_15__comment"></textarea>
                    </div>
                </div>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-light btn-sm" data-bs-dismiss="modal">Отмена</button>
                <button id="modal_candidate_status_15__save" type="button" class="btn btn-primary btn-sm">Сохранить
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" tabindex="-1" id="modal_candidate_status_16">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Оформление</h3>
                <input type="hidden" id="modal_candidate_status_16_id">

                <!--begin::Close-->
                <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal"
                     aria-label="Close">
                    <span class="svg-icon svg-icon-2x"></span>
                </div>
                <!--end::Close-->
            </div>
            <!--begin::Modal body-->
            <div class="modal-body">
                <div class="row mb-5">
                    <div class="col">

                        <div class="d-flex flex-column mb-0 fv-row">
                            <label for="modal_candidate_status_16__date" class="fs-5 fw-bold mb-2">Дата
                                перезвона</label>
                            <input
                                id="modal_candidate_status_16__date"
                                class="form-control form-control-sm form-control-solid"
                                type="text"/>
                        </div>
                    </div>
                </div>
                <div class="row mb-5">
                    <div class="col">
                        <label for="modal_candidate_status_16__comment"
                               class="required fs-5 fw-bold mb-2">Комментарий</label>
                        <textarea class="form-control form-control-sm form-control-solid"
                                  cols="30" id="modal_candidate_status_16__comment"></textarea>
                    </div>
                </div>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-light btn-sm" data-bs-dismiss="modal">Отмена</button>
                <button id="modal_candidate_status_16__save" type="button" class="btn btn-primary btn-sm">Сохранить
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    $('#modal_candidate_status_13__save').click(function () {
        let comment = $('#modal_candidate_status_13__comment').val().trim();
        let id = $('#modal_candidate_status_13_id').val();
        if (comment === '') {
            toastr.error('Заполните комментарий!');
            return '';
        }

        let data = {
            id: id,
            comment: comment,
            status: 13,
            _token: $('input[name=_token]').val()
        }

        $.ajax({
            url: "{{url('/')}}/candidate/set_status_special",
            method: 'post',
            data: data,
            success: function (response, status, xhr, $form) {
                if (response.error) {
                    toastr.error(response.error);
                } else {
                    toastr.success('Сохранено');
                }
                $('#modal_candidate_status_13').modal('hide');
                oTable.draw();
            }
        });

    });
    $('#modal_candidate_status_14__save').click(function () {
        let comment = $('#modal_candidate_status_14__comment').val().trim();
        let id = $('#modal_candidate_status_14_id').val();
        let date = $('#modal_candidate_status_14__date').val();
        if (comment === '') {
            toastr.error('Заполните комментарий!');
            return '';
        }
        if (date === '') {
            toastr.error('Заполните дату!');
            return '';
        }
        let data = {
            id: id,
            date: date,
            comment: comment,
            status: 14,
            _token: $('input[name=_token]').val()
        }

        $.ajax({
            url: "{{url('/')}}/candidate/set_status_special",
            method: 'post',
            data: data,
            success: function (response, status, xhr, $form) {
                if (response.error) {
                    toastr.error(response.error);
                } else {
                    toastr.success('Сохранено');
                }
                $('#modal_candidate_status_14').modal('hide');
                oTable.draw();

                $('#modal_candidate_status_14__comment').val('');
                $('#modal_candidate_status_14_id').val('');
                $('#modal_candidate_status_14__date').val('');
            }
        });

    });
    $('#modal_candidate_status_15__save').click(function () {
        let comment = $('#modal_candidate_status_15__comment').val().trim();
        let id = $('#modal_candidate_status_15_id').val();
        let date = $('#modal_candidate_status_15__date').val();
        let countFail = +$('#modal_candidate_status_15_callFailed').val();

        if (countFail === 3) {
            if (comment === '') {
                toastr.error('Заполните комментарий!');
                return '';
            }
            if (date === '') {
                toastr.error('Заполните дату!');
                return '';
            }
        }

        let data = {
            id: id,
            date: date,
            comment: comment,
            status: 15,
            _token: $('input[name=_token]').val()
        }

        $.ajax({
            url: "{{url('/')}}/candidate/set_status_special",
            method: 'post',
            data: data,
            success: function (response, status, xhr, $form) {
                if (response.error) {
                    toastr.error(response.error);
                } else {
                    toastr.success('Сохранено');
                }
                $('#modal_candidate_status_15').modal('hide');
                oTable.draw();

                $('#modal_candidate_status_15__comment').val('');
                $('#modal_candidate_status_15_id').val('');
                $('#modal_candidate_status_15__date').val('');
            }
        });

    });
    $('#modal_candidate_status_16__save').click(function () {
        let comment = $('#modal_candidate_status_16__comment').val().trim();
        let id = $('#modal_candidate_status_16_id').val();
        let date = $('#modal_candidate_status_16__date').val();
        if (comment === '') {
            toastr.error('Заполните комментарий!');
            return '';
        }
        if (date === '') {
            toastr.error('Заполните дату!');
            return '';
        }
        let data = {
            id: id,
            date: date,
            comment: comment,
            status: 16,
            _token: $('input[name=_token]').val()
        }

        $.ajax({
            url: "{{url('/')}}/candidate/set_status_special",
            method: 'post',
            data: data,
            success: function (response, status, xhr, $form) {
                if (response.error) {
                    toastr.error(response.error);
                } else {
                    toastr.success('Сохранено');
                }
                $('#modal_candidate_status_16').modal('hide');
                oTable.draw();

                $('#modal_candidate_status_16__comment').val('');
                $('#modal_candidate_status_16_id').val('');
                $('#modal_candidate_status_16__date').val('');
            }
        });

    });

    $('#modal_candidate_status_14__date').flatpickr({
        dateFormat: 'd.m.Y',
        locale: {
            firstDayOfWeek: 1
        },
    });
    $('#modal_candidate_status_15__date').flatpickr({
        dateFormat: 'd.m.Y',
        locale: {
            firstDayOfWeek: 1
        },
    });
    $('#modal_candidate_status_16__date').flatpickr({
        dateFormat: 'd.m.Y',
        locale: {
            firstDayOfWeek: 1
        },
    });

    function changeActivation(id, count_failed_call) {
        let reason_reject = '';

        var changeActivation = $('.changeActivation' + id).val();

        if (changeActivation == 13 || changeActivation == 14 || changeActivation == 15 || changeActivation == 16) {

            if (count_failed_call == 2) {
                $('.callFailed').show();
            } else {
                $('.callFailed').hide();
            }

            $('#modal_candidate_status_15_callFailed').val(count_failed_call);
            $('#modal_candidate_status_' + changeActivation + '_id').val(id);
            $('#modal_candidate_status_' + changeActivation).modal('show');
            return '';
        }

        if (changeActivation == 2 || changeActivation == 4 || changeActivation == 6 || changeActivation == 8) {
            Swal.fire({
                html: `Сменить статус?`,
                icon: "question",
                buttonsStyling: false,
                showCancelButton: true,
                confirmButtonText: "Да!",
                cancelButtonText: 'Нет, отмена!',
                customClass: {
                    confirmButton: "btn btn-primary",
                    cancelButton: 'btn btn-secondary'
                }
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {


                    $.get('{{url('/')}}/candidate/set_status?r=&s=' + changeActivation + '&id=' + id, function (res) {
                        if (res.error) {
                            toastr.error(res.error);
                        } else {
                            toastr.success('Успешно');
                        }
                        oTable.draw();
                    });
                }
            });
        } else {


            if (changeActivation == 3) {
                reason_reject = prompt('Причина отказа?');
                if (reason_reject === '') {
                    toastr.error('Укажите причину');
                    oTable.draw();
                    return '';
                }


            }
            if (reason_reject != null) {
                $.get('{{url('/')}}/candidate/set_status?r=' + reason_reject + '&s=' + changeActivation + '&id=' + id, function (res) {
                    if (res.error) {
                        toastr.error(res.error);
                    } else {
                        toastr.success('Успешно');
                    }
                    oTable.draw();
                });
            }


        }


    }

    function setCountFailCall(id, count_failed_call) {
        if (+count_failed_call === 2) {
            $('.callFailed').show();
        } else {
            $('.callFailed').hide();
        }

        $('#modal_candidate_status_15_callFailed').val(count_failed_call);
        $('#modal_candidate_status_15_id').val(id);
        $('#modal_candidate_status_15' ).modal('show');
        return '';
    }
</script>
